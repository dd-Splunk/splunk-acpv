---
name: "package-app"

on:
  workflow_dispatch:
  push:
    branches:
      - main
jobs:
  tagged-release:
    name: "Package App"
    runs-on: "ubuntu-latest"
    steps:
      # ...
      - name: Checkout
        uses: actions/checkout@v3
      - name: Create spl
        run: |
          mv app ${APP_NAME}
          COPYFILE_DISABLE=1 tar -cvzf ${APP_NAME}.spl ${APP_NAME}
        env:
          APP_NAME: ${{ github.event.repository.name }}
        # ...
      # - name: Create Draft Release
      #   id: create_release
      #   uses: actions/create-release@v1
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #   with:
      #     tag_name: latest
      #     release_name: Releases ${{ github.ref }}
      #     draft: true
      #     prerelease: false

      - name: Upload Release
        uses: ncipollo/release-action@v1.12.0
        with:
          tag: latest
          artifacts: "splunk-acpv.spl"
          token: ${{ secrets.GITHUB_TOKEN }}
        env:
          APP_NAME: ${{ github.event.repository.name }}

      # - name: Publish release
      #   uses: StuYarrow/publish-release@v1.1.2
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #   with:
      #     id: ${{ steps.create_release.outputs.id }}
